var path=require("path"),express=require("express"),nunjucks=require("nunjucks"),favicon=require("serve-favicon"),logger=require("morgan"),cookieParser=require("cookie-parser"),bodyParser=require("body-parser"),session=require("express-session"),routes=require("./routes/index.js"),settings=require("./settings"),fs=require("fs"),accessLog=fs.createWriteStream("access.log",{flags:"a"}),errorLog=fs.createWriteStream("error.log",{flags:"a"}),app=express();app.set("port",process.env.PORT||2369),nunjucks.configure("views",{autoescape:!0,express:app}),app.use(favicon(path.join(__dirname,"public","/default/assets/images/favicon.ico"))),app.use(logger("dev")),app.use(logger("combined",{stream:accessLog})),app.use(bodyParser.urlencoded({extended:!1})),app.use(cookieParser()),app.use(session({secret:settings.cookieSecret,key:settings.db,cookie:{maxAge:864e5},resave:!1,saveUninitialized:!0})),app.use(express.static(path.join(__dirname,"public"))),routes(app),app.use(function(e,s,r,o){console.log(e);var a="["+new Date+"] "+s.url+"\n";errorLog.write(a+e.stack+"\n"),o()}),app.listen(app.get("port"),function(){console.log("Express server listening on port "+app.get("port"))}),process.on("uncaughtException",function(e){console.log(e),console.log(e.stack);var s="["+new Date+"] "+e.message+"\n";errorLog.write(s+e.stack+"\n")});