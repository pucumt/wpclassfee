var model=require("../../model.js"),pageSize=model.db.config.pageSize,auth=require("./auth.js"),Question=model.question;module.exports=function(e){e.get("/admin/questionList",auth.checkLogin),e.get("/admin/questionList",auth.checkSecure([100])),e.get("/admin/questionList",function(e,i){i.render("Server/questionList.html",{user:e.session.admin,websiteTitle:model.db.config.websiteTitle})}),e.post("/admin/question/search",auth.checkLogin),e.post("/admin/question/search",auth.checkSecure([100])),e.post("/admin/question/search",function(e,i){var s=e.query.p?parseInt(e.query.p):1,t={};e.body.name&&e.body.name.trim()&&(t.name={$like:`%${e.body.name.trim()}%`}),e.body.isChecked&&(t.isChecked=e.body.isChecked),Question.getFiltersWithPage(s,t).then(function(e){i.jsonp({questions:e.rows,total:e.count,page:s,isFirstPage:s-1==0,isLastPage:(s-1)*pageSize+e.rows.length==e.count})}).catch(e=>{})}),e.post("/admin/question/pass",auth.checkLogin),e.post("/admin/question/pass",auth.checkSecure([100])),e.post("/admin/question/pass",function(e,i){Question.update({isChecked:1,checkedBy:e.session.admin._id},{where:{_id:e.body.id}}).then(function(e){i.jsonp({sucess:!0})}).catch(function(){i.jsonp({error:"更改失败"})})}),e.post("/admin/question/refuse",auth.checkLogin),e.post("/admin/question/refuse",auth.checkSecure([100])),e.post("/admin/question/refuse",function(e,i){Question.update({isChecked:9,checkedBy:e.session.admin._id},{where:{_id:e.body.id}}).then(function(e){i.jsonp({sucess:!0})}).catch(function(){i.jsonp({error:"更改失败"})})})};